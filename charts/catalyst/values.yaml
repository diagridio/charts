---
#-----------------------------------------------------------------------------
# JOIN_TOKEN: Required value for the agent to register with catalyst.
#-----------------------------------------------------------------------------

join_token: ""
#------------------------------------------------------------------------------
# Global Options
#------------------------------------------------------------------------------
global:
  # Override the name of the chart
  nameOverride: ""
  # Override the full name of the chart+release
  fullnameOverride: ""
  image:
    # Global image pull policy for all container images in the chart
    # Can be overridden by individual image pullPolicy
    pullPolicy: Always
    # Global list of secret names for image pull secrets across all pod specs
    # Secrets must exist in the same namespace
    # Reference: https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/
    imagePullSecrets: []
    # Global registry for all container images in the chart
    registry: ""
  # Global labels applied to all resources deployed by the chart
  labels: {}
  serviceAccount:
    # Annotations to add to the agent and management service account
    annotations: {}
  # Secrets config for integrating with a secret provider
  secrets:
    # Supported values: kubernetes, aws
    provider: kubernetes
    aws:
      # Required aws region to access AWS Secrets Manager
      region: ""
      # Optional, access key and secret key par to access AWS Secrets Manager
      access_key: ""
      secret_access_key: ""
  # Global control plane URL
  control_plane_url: cra-cloudgrid.prd.p.diagrid.io:443
  # Global sentry configuration
  sentry:
    enabled: true
    endpoint: dapr-sentry.root-dapr-system.svc.cluster.local:443
    remote_endpoint: sentry.prd.p.diagrid.io:443
    diagrid_trust_anchors_endpoint: https://pem.trust.diagrid.io
    diagrid_trust_anchors_endpoint_insecure: false
    trust_domain: prj-root.trust.diagrid.io
    namespace: root-dapr-system
    trust_anchors_file: "/var/run/secrets/diagrid.io/trust/ca.crt"
  # Global nats configuration
  nats:
    endpoint: tls://client.events.prd.p.diagrid.io:443
    trust_domain: trust.diagrid.io
  # Global feature flags
  featureflags:
    nats_enabled: true
    agent_component_validation: false
#------------------------------------------------------------------------------
# Shared Configurations
# TODO not implemented yet
#------------------------------------------------------------------------------
shared:
  nodeSelector: {}
  tolerations: []
  affinity: {}
#------------------------------------------------------------------------------
# Agent Configurations
#------------------------------------------------------------------------------
agent:
  logLevel: info
  config:
    host:
      private_region: true
      ingress_ip_addr: ""
      egress_addresses: []
    control_plane_http_url: https://api.diagrid.io
    placement:
      max_project_count: 50
    project:
      default_managed_pubsub_type: kafka-shared-disabled
      default_managed_state_store_type: postgresql-shared-disabled
      ingress_tls_secret_name: ""
      default_workflow: namespace
    sidecar:
      # default to disable API validation because ingress could be not configured by users
      skip_api_validation: true
      image_registry: "us-central1-docker.pkg.dev/prj-common-d-shared-89549/reg-d-common-docker-public"
      image_tag: "0.427.0"
      resources:
        limits:
          cpu: 300m
          memory: 256Mi
        requests:
          cpu: 10m
          memory: 25Mi
      service_account_annotations: []
    api_token_error:
      enabled: false
    otel:
      enabled: true
      image_repository: "us-central1-docker.pkg.dev/prj-common-d-shared-89549/reg-d-common-docker-public/diagrid-otel-collector"
      image_tag: "0.427.0"
      metrics_endpoint: https://cra-metrics.prd.p.diagrid.io/api/v1/push
      loki_endpoint: https://cra-logs.prd.p.diagrid.io/loki/api/v1/push
      metrics_tls_insecure: false
      loki_tls_insecure: false
      internal_cortex_enabled: false
      internal_cortex_endpoint: ""
      internal_cortex_org_id: common
      loki_enabled: true
      logs_resources:
        limits:
          memory: 750Mi
        requests:
          cpu: 50m
          memory: 500Mi
      metrics_resources:
        limits:
          memory: 1100Mi
        requests:
          cpu: 75m
          memory: 500Mi
    upstream_dapr:
      # images wil be pulled from a dockerhub proxy so we don't hit ratelimits
      container_registry: "us-central1-docker.pkg.dev/prj-common-d-shared-89549/reg-d-common-docker-hub-proxy/daprio"
    internal_dapr:
      container_registry: "us-central1-docker.pkg.dev/prj-common-d-shared-89549/reg-d-common-docker-public"
      ca:
        trust_anchors_config_map_name: ca-certificates-bundle
      sentry_resources:
        limits:
          memory: 100Mi
      scheduler_resources:
        limits:
          memory: 175Mi
        requests:
          memory: 130Mi
      scheduler:
        # storage_class: ""
        storage_size: 8Gi
    artifacts:
      # make sure the k8s container image version works with the vcluster chart version when updating these, best is to copy the container image version from the vcluster release
      vcluster_k0s_chart_version: "0.15.2"
      vcluster_k0s_container_image: "us-central1-docker.pkg.dev/prj-common-d-shared-89549/reg-d-common-docker-hub-proxy/k0sproject/k0s:v1.26.0-k0s.0"
      core_dns_container_image: "us-central1-docker.pkg.dev/prj-common-d-shared-89549/reg-d-common-docker-hub-proxy/coredns/coredns:1.10.1"
      internal_registry_username: ""
      internal_registry_password: ""
      internal_repo_url: oci://public.ecr.aws/diagrid
    kubernetes:
      qps: 25
      burst: 10
    denylist:
      enabled: false
    featureflags: {}
  metrics:
    port: 9090
  replicaCount: 1
  image:
    registry: "us-central1-docker.pkg.dev/prj-common-d-shared-89549/reg-d-common-docker-public"
    name: cra-agent
    tag: "0.427.0"
    fullName: ""
    pullPolicy: Always
  nameOverride: ""
  fullnameOverride: ""
  service:
    type: ClusterIP
    port: 9090
  serviceAccount:
    # Annotations to add to the service account
    annotations: {}
    # The name of the service account to use.
    # If not set and create is true, a name is generated using the fullname template
    name: ""
  podAnnotations:
    prometheus.io/port: "9090"
    prometheus.io/scrape: "true"
  podSecurityContext: {}
  # fsGroup: 2000

  securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

  resources:
    limits:
      memory: 1200Mi
    requests:
      cpu: 40m
      memory: 500Mi
  nodeSelector: {}
  tolerations: []
  affinity: {}
  # Golang Soft Memory Limit via env var GOMEMLIMIT
  goSoftLimit:
    percent: 90
  #  override: 600MiB  # it will set GOMEMLIMIT to this value. Supported suffixes, if not using a straight bytes number, are B, KiB, MiB, GiB, and TiB.

  extraEnvs: []
  merge: {}
  patch: {}
#------------------------------------------------------------------------------
# Gateway Configuration
#------------------------------------------------------------------------------
gateway:
  tls:
    enabled: false
    # Name of the secret containing TLS certificates
    secretName: "gateway-tls-certs"
    # TLS certificate configuration
    certificates:
      # Path to the TLS certificate file
      certFile: "/etc/ssl/certs/tls.crt"
      # Path to the TLS key file
      keyFile: "/etc/ssl/certs/tls.key"
      # Optional: Path to the CA certificate file for client certificate validation
      caFile: ""
    # Volume configuration for mounting TLS certificates
    volumes:
      # Mount path for TLS certificates
      mountPath: "/etc/ssl/certs"
  # Enable High Availability mode for gateway components
  ha:
    enabled: false
    # Minimum number of replicas when HA is enabled
    minReplicas: 2
  identityInjector:
    image:
      tag: "0.427.0"
      name: "identity-injector"
      registry: "us-central1-docker.pkg.dev/prj-common-d-shared-89549/reg-d-common-docker-public"
    resources:
      limits:
        cpu: 50m
        memory: 50Mi
      requests:
        cpu: 10m
        memory: 15Mi
  envoy:
    # If HA is enabled, this will be overridden by gateway.ha.minReplicas
    replicaCount: 1
    image:
      tag: distroless-v1.33.0
      name: envoyproxy/envoy
      registry: "us-central1-docker.pkg.dev/prj-common-d-shared-89549/reg-d-common-docker-hub-proxy"
    admin:
      enabled: true
      address: "127.0.0.1"
      port: 9090
    serviceAccount:
      name: gateway-envoy
      annotations: {}
    configmap:
      name: envoy-config
    service:
      name: gateway-envoy
      appLabel: envoy
      port: 8080
      targetPort: 8080
      # HTTPS port configuration
      httpsPort: 8443
      httpsTargetPort: 8443
      type: ClusterIP
    xds:
      connect_timeout: 10s
      health_check:
        timeout: 5s
        interval: 15s
        unhealthy_threshold: 2
        healthy_threshold: 1
        path: /healthz
        port: 57205
      connection_keepalive:
        interval: 30s
        timeout: 10s
      hostname: gateway-controlplane
      port: 57206
    podAnnotations: {}
    labels:
      app: gateway-envoy
    selectorLabels:
      app: gateway-envoy
    merge:
      labels: {}
      selectorLabels: {}
    podSecurityContext:
      runAsNonRoot: true
      fsGroup: 2000
    securityContext:
      capabilities:
        drop:
          - ALL
      readOnlyRootFilesystem: true
      allowPrivilegeEscalation: false
    nodeSelector: {}
    affinity: {}
    tolerations: []
    resources:
      limits:
        cpu: 1000m
        memory: 2048Mi
      requests:
        cpu: 100m
        memory: 512Mi
  controlplane:
    # If HA is enabled, this will be overridden by gateway.ha.minReplicas
    replicaCount: 1
    xds:
      mtls:
        enabled: true
    image:
      tag: "0.427.0"
      name: catalyst-gateway
      registry: "us-central1-docker.pkg.dev/prj-common-d-shared-89549/reg-d-common-docker-public"
    serviceAccount:
      name: gateway-controlplane
      annotations: {}
    deployment:
      httpHealthCheck:
        containerPort: 57205
      httpXDS:
        containerPort: 57206
    service:
      name: gateway-controlplane
      appLabel: gateway-controlplane
      httpHealthCheck:
        port: 57205
        targetPort: 57205
      httpXDS:
        port: 57206
        targetPort: 57206
      type: ClusterIP
      clusterIP: None
    podAnnotations: {}
    labels:
      app: gateway-controlplane
    selectorLabels:
      app: gateway-controlplane
    merge:
      labels: {}
      selectorLabels: {}
    podSecurityContext:
      runAsNonRoot: true
      fsGroup: 2000
    securityContext:
      capabilities:
        drop:
          - ALL
      readOnlyRootFilesystem: true
      allowPrivilegeEscalation: false
    nodeSelector: {}
    affinity: {}
    tolerations: []
    resources:
      limits:
        cpu: 100m
        memory: 100Mi
      requests:
        cpu: 50m
        memory: 50Mi
    config: {}
#------------------------------------------------------------------------------
# Management Service Configurations
#------------------------------------------------------------------------------
management:
  logLevel: info
  config:
    http_server:
      enabled: true
      port: 8181
    http_server_auth:
      enabled: true
      domain: "api.diagrid.io"
      audience: "admingrid-api"
    grpc_server:
      enabled: false
    profiling:
      enabled: false
    featureflags: {}
  replicaCount: 2
  image:
    registry: "us-central1-docker.pkg.dev/prj-common-d-shared-89549/reg-d-common-docker-public"
    name: catalyst-management
    tag: "0.427.0"
    pullPolicy: Always
  nameOverride: ""
  fullnameOverride: ""
  service:
    type: ClusterIP
    port: 9090
  http_service:
    type: ClusterIP
    port: 8181
  ingress:
    enabled: false
    dns_top_level_domain: ""
  serviceAccount:
    # Annotations to add to the service account
    annotations: {}
    # The name of the service account to use.
    # If not set and create is true, a name is generated using the fullname template
    name: ""
  podAnnotations:
    prometheus.io/port: "9091"
    prometheus.io/scrape: "true"
  podSecurityContext: {}
  # fsGroup: 2000

  securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

  resources:
    limits:
      memory: 1200Mi
    requests:
      cpu: 40m
      memory: 100Mi
  nodeSelector: {}
  tolerations: []
  affinity: {}
  # Golang Soft Memory Limit via env var GOMEMLIMIT
  goSoftLimit:
    percent: 90
  #  override: 600MiB  # it will set GOMEMLIMIT to this value. Supported suffixes, if not using a straight bytes number, are B, KiB, MiB, GiB, and TiB.

  extraEnvs: []
  merge: {}
  patch: {}
